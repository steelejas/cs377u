extends layout.pug
    
block content
    ////////////
    // STYLE //
    style.
        body {
            background-color: black;
            color: white;
        }
        .logout-button {
            background-color: var(--SPOTIFY_COD_GRAY);
            color: var(--SPOTIFY_MTN_MEADOW);
        }
        .library-button {
            background-color: var(--SPOTIFY_MTN_MEADOW);
            color: white;
        }
        td img {
            width: 50px;
            height: 50px;
            margin-right: 5px;
        }

    //////////////
    // CONTENT //

    // LOGOUT BUTTON
    a(onclick='logout()', class='logout-button button') Logout

    // GREETINGS HEADER
    img(src=user.images[0].url, class='circular_image')
    br
    
    h1 Welcome, #{user.id}!

    h2 Rediscover your music library...

    a(href='/library', class='library-button button') Find me 10 forgotten songs from my entire Spotify library! âœ¨

    h2 Or, choose one of your playlists to rediscover...

    div
      table 
        each p in playlists
          tr 
            - var playlist_name = p.name
            - var playlist_url = p.uri
            - var playlist_num_tracks = p.tracks.total
            - var playlist_id = p.id

            td: img(class='playlist_image', src=p.images[0].url || 'https://via.placeholder.com/50', alt='Playlist Cover')
            
            td: a(href='/playlist?id=' + playlist_id) #{playlist_name}

            td #{playlist_num_tracks} songs

    //////////////
    // SCRIPTS //

    // HANDLE LOGOUT CLEANUP
    script.
      function logout() {
          // Show confirmation dialog
          var confirmLogout = confirm("Hey! Are you sure you want to log out?");
          
          if (confirmLogout) {
              document.cookie.split(";").forEach(function(c) {
                  document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
              });
              localStorage.clear();
              window.location.href = '/';
          } else {
              // If user cancels, do nothing
              return;
          }
      }
