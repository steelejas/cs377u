extends layout.pug
    
block content
    ////////////
    // STYLE //
    style.
        h1 {
            font-size: 40px;
            text-align: left;
            flex-grow: 1;  
            overflow: hidden; 
            text-overflow: ellipsis;
        }
        body {
            background-color: black;
            color: white;
        }
        .logout-button {
            background-color: var(--SPOTIFY_COD_GRAY);
            color: var(--SPOTIFY_MTN_MEADOW);
        }
        .greetings-container {
            display: flex;
            align-items: center;
        }
        td img {
            width: 50px;
            height: 50px;
            margin-right: 5px;
        }
        .library-button {
            background: linear-gradient(
                180deg, 
                var(--SPOTIFY_MTN_MINT), 
                var(--SPOTIFY_MTN_MEADOW));
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            color: white;
            border-radius: 100%;
            width: 100;
            height: 100;
            font-size: 48px; 
            text-align: center;
            text-decoration: none;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative; /* Needed for animation */
            animation: pulse 2s infinite alternate;
            text-shadow: 0 0 3px #FF0000;
            margin-top: 30px;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }
        .playlist-button {
            background: var(--SPOTIFY_COD_GRAY);
            color: var(--SPOTIFY_MTN_MEADOW);
            border-style: solid;
            border-width: 1px;
            border-color: var(--SPOTIFY_MTN_MEADOW);
            border-radius: 20px;
        }
        .playlist-button:hover {
            background: var(--SPOTIFY_MTN_MEADOW);
            color: black;
        }

    //////////////
    // CONTENT //

    // LOGOUT BUTTON
    a(onclick='logout()', class='logout-button button') Logout

    // GREETINGS HEADER
    div.greetings-container
        h1 Welcome, #{user.id}!
        
        if user.images && user.images.length > 0
            img(src=user.images[0].url, class='circular_image')
        else
            img(src="https://images.unsplash.com/photo-1617957743097-0d20aa2ea762?q=80&w=2064&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", class='circular_image')

    a(href='/library', class='library-button button')
        | ðŸª„
    
    h2 It's time to rediscover the unplayed.

    h3 Ready to explore the unknown corners of your Spotify library? Tap the button above to rewrap 10 forgotten songs from your entire library! 

    br

    h2 Or... looking for a specific vibe?

    h3 Browse through your playlists and select any to rediscover the tracks that rarely make it to your ears. Itâ€™s all about giving a song a second chance to become your new favorite.

    div
        if playlists && playlists.length > 0
            table
                each p in playlists
                    tr
                      - var playlist_name = p.name
                      - var playlist_uri = p.uri
                      - var playlist_num_tracks = p.tracks.total
                      - var playlist_id = p.id

                      //td: img(class='playlist_image', src=(p.images && p.images.length > 0) ? p.images[0].url : 'https://www.solidbackgrounds.com/images/1920x1080/1920x1080-gray-solid-color-background.jpg', alt='Playlist Cover')

                      //td: a(href='/playlist?id=' + playlist_id) #{playlist_name}

                      //td(class='track-detail') #{playlists.indexOf(p) + 1}
                      
                      td: a(href=playlist_uri): img(src=(p.images && p.images.length > 0) ? p.images[0].url : 'https://www.solidbackgrounds.com/images/1920x1080/1920x1080-gray-solid-color-background.jpg', class='album-thumbnail', alt='Playlist cover for' + album_name)
                      td: div(class='track-title')
                          a(href=playlist_uri, class='track-title') #{playlist_name}
                          p(class='track-detail') #{playlist_num_tracks} songs
                      td: a(href='/playlist?id=' + playlist_id, class='playlist-button button') Rewrap
                      

        else
            p.empty-library Itâ€™s unusually quiet in here... Looks like there are no playlists yet! It's the perfect moment to start building some. 


    //////////////
    // SCRIPTS //

    // HANDLE LOGOUT CLEANUP
    script.
      function logout() {
          // Show confirmation dialog
          var confirmLogout = confirm("Hey! Are you sure you want to log out?");
          
          if (confirmLogout) {
              document.cookie.split(";").forEach(function(c) {
                  document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
              });
              localStorage.clear();
              window.location.href = '/';
          } else {
              // If user cancels, do nothing
              return;
          }
      }
